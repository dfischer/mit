# Test pickling VM state.
#
# (c) Mit authors 2019
#
# The package is distributed under the MIT/X11 License.
#
# THIS PROGRAM IS PROVIDED AS IS, WITH NO WARRANTY. USE IS AT THE USERâ€™S
# RISK.

import pickle

from mit.globals import *


# Load pforth image and run it, defining a new word
load("@top_srcdir@/src/features/pforth/src/mit/pforth-base")
run(['--evaluate', ': FOO ;'])
pc.set(0)
ir.set(0)

# Pickle the VM
s = pickle.dumps(VM)

# Unpickle the VM
VM2 = pickle.loads(s)
VM2.run(['--evaluate', 'FOO'])


print("Pickle tests ran OK")
