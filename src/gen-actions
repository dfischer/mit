#!/usr/bin/env python3

from vm_data import Actions

print('// Auto-generated by gen-actions - DO NOT EDIT.\n')

print('''\
#define RAISE(code)                             \\
        if (exception == 0) exception = (code);

static void STEP(smite_state *S) {
    S->ITYPE = smite_decode_instruction(S, &S->PC, &S->I);

    switch (S->ITYPE) {
    case INSTRUCTION_NUMBER:
        PUSH(S->I);
        return;
    case INSTRUCTION_ACTION:
        switch (S->I) {''')
for (instruction, action) in Actions.__members__.items():
    print('''\
        case O_{}:
            {{
{}
            }}
            return;'''.format(
        instruction,
        action.value.code.replace('        ', '                '),
    ))
print('''\
        default: /* Undefined instruction */
            exception = -256;
            return;
        }
    default: /* Exception during instruction fetch */
        exception = S->ITYPE;
        return;
    }
}''')
