#!/usr/bin/env python3

from vm_data import Actions

print('// Auto-generated by gen-actions - DO NOT EDIT.\n')

print('''\
#define RAISE(code)                             \\
        exception = (code);

#define STEP(S)                                 \\
    S->ITYPE = smite_decode_instruction(S, &S->PC, &S->I); \\
    switch (S->ITYPE) {                         \\
    case INSTRUCTION_NUMBER:                    \\
        PUSH(S->I);                             \\
        break;                                  \\
    case INSTRUCTION_ACTION:                    \\
        switch (S->I) {                         \\
                                                \\''')
for (instruction, action) in Actions.__members__.items():
    print('''\
        case O_{}:                              \\
            {{                                   \\
\\{}
            }}                                   \\
            break;                              \\
                                                \\'''.format(instruction, action.value.code[:-1].replace('\n', '\\\n         ')[1:-13]))
print('''\
                                                \\
        default: /* Undefined instruction */    \\
            exception = -256;                   \\
            break;                              \\
        }                                       \\
        break;                                  \\
                                                \\
    default: /* Exception during instruction fetch */ \\
        exception = S->ITYPE;                   \\
        break;                                  \\
    }                                           \\
''')
