#!/usr/bin/env python3
# Dump Mit object file as hex and disassembly
# (c) Mit authors 2018-2019
# This file is in the public domain.

import sys
import os

import mit@PACKAGE_SUFFIX@

if len(sys.argv) != 2:
    print("Usage: mit-dump OBJECT-FILE")
    sys.exit(1)
filename = sys.argv[1]
basename, ext = os.path.splitext(filename)

VM = mit.State()
length = VM.load(filename)

asm_filename = "{}.asm".format(basename)
with open(asm_filename, "w") as h:
    VM.disassemble(0, length, file=h)

hex_filename = "{}.hex".format(basename)
with open(hex_filename, "w") as h:
    VM.dump(0, length, file=h)
