#!/usr/bin/env python3
#
# (c) Mit authors 2018-2020
#
# This file is in the public domain.
#
# THIS PROGRAM IS PROVIDED AS IS, WITH NO WARRANTY. USE IS AT THE USERâ€™S
# RISK.

import sys
import os
import argparse

import mit@PACKAGE_SUFFIX@


# Command-line arguments.
parser = argparse.ArgumentParser(
    prog='mit-dump',
    description='Dump Mit object file as hex and disassembly',
)
parser.add_argument(
    'object_file',
    metavar='OBJECT-FILE',
    nargs='+',
    help='object file to use',
)
args = parser.parse_args()

for filename in args.object_file:
    basename, ext = os.path.splitext(filename)

    VM = mit.State()
    length = VM.load(filename)

    asm_filename = "{}.asm".format(basename)
    with open(asm_filename, "w") as h:
        VM.disassemble(0, length, file=h)

    hex_filename = "{}.hex".format(basename)
    with open(hex_filename, "w") as h:
        VM.dump(0, length, file=h)
